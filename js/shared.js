// Default array of languages for when the API is unreachable
// Generated using: var array = await getWikis(); console.log('Prefixes:', JSON.stringify(array[0])); console.log('Languages:', JSON.stringify(array[1]));
const defaultPrefixArray = [
    "aa",
    "ab",
    "ace",
    "ady",
    "af",
    "ak",
    "als",
    "alt",
    "am",
    "ami",
    "an",
    "ang",
    "ar",
    "arc",
    "ary",
    "arz",
    "as",
    "ast",
    "atj",
    "av",
    "avk",
    "awa",
    "ay",
    "az",
    "azb",
    "ba",
    "ban",
    "bar",
    "bat-smg",
    "bcl",
    "be",
    "be-tarask",
    "be-x-old",
    "bg",
    "bh",
    "bi",
    "bjn",
    "blk",
    "bm",
    "bn",
    "bo",
    "bpy",
    "br",
    "bs",
    "bug",
    "bxr",
    "ca",
    "cbk-zam",
    "cdo",
    "ce",
    "ceb",
    "ch",
    "cho",
    "chr",
    "chy",
    "ckb",
    "co",
    "cr",
    "crh",
    "cs",
    "csb",
    "cu",
    "cv",
    "cy",
    "da",
    "dag",
    "de",
    "din",
    "diq",
    "dsb",
    "dty",
    "dv",
    "dz",
    "ee",
    "el",
    "eml",
    "en",
    "eo",
    "es",
    "et",
    "eu",
    "ext",
    "fa",
    "ff",
    "fi",
    "fiu-vro",
    "fj",
    "fo",
    "fr",
    "frp",
    "frr",
    "fur",
    "fy",
    "ga",
    "gag",
    "gan",
    "gcr",
    "gd",
    "gl",
    "glk",
    "gn",
    "gom",
    "gor",
    "got",
    "gu",
    "guw",
    "gv",
    "ha",
    "hak",
    "haw",
    "he",
    "hi",
    "hif",
    "ho",
    "hr",
    "hsb",
    "ht",
    "hu",
    "hy",
    "hyw",
    "hz",
    "ia",
    "id",
    "ie",
    "ig",
    "ii",
    "ik",
    "ilo",
    "inh",
    "io",
    "is",
    "it",
    "iu",
    "ja",
    "jam",
    "jbo",
    "jv",
    "ka",
    "kaa",
    "kab",
    "kbd",
    "kbp",
    "kcg",
    "kg",
    "ki",
    "kj",
    "kk",
    "kl",
    "km",
    "kn",
    "ko",
    "koi",
    "kr",
    "krc",
    "ks",
    "ksh",
    "ku",
    "kv",
    "kw",
    "ky",
    "la",
    "lad",
    "lb",
    "lbe",
    "lez",
    "lfn",
    "lg",
    "li",
    "lij",
    "lld",
    "lmo",
    "ln",
    "lo",
    "lrc",
    "lt",
    "ltg",
    "lv",
    "mad",
    "mai",
    "map-bms",
    "mdf",
    "mg",
    "mh",
    "mhr",
    "mi",
    "min",
    "mk",
    "ml",
    "mn",
    "mni",
    "mnw",
    "mo",
    "mr",
    "mrj",
    "ms",
    "mt",
    "mus",
    "mwl",
    "my",
    "myv",
    "mzn",
    "na",
    "nah",
    "nap",
    "nds",
    "nds-nl",
    "ne",
    "new",
    "ng",
    "nia",
    "nl",
    "nn",
    "no",
    "nov",
    "nqo",
    "nrm",
    "nso",
    "nv",
    "ny",
    "oc",
    "olo",
    "om",
    "or",
    "os",
    "pa",
    "pag",
    "pam",
    "pap",
    "pcd",
    "pcm",
    "pdc",
    "pfl",
    "pi",
    "pih",
    "pl",
    "pms",
    "pnb",
    "pnt",
    "ps",
    "pt",
    "pwn",
    "qu",
    "rm",
    "rmy",
    "rn",
    "ro",
    "roa-rup",
    "roa-tara",
    "ru",
    "rue",
    "rw",
    "sa",
    "sah",
    "sat",
    "sc",
    "scn",
    "sco",
    "sd",
    "se",
    "sg",
    "sh",
    "shi",
    "shn",
    "shy",
    "si",
    "simple",
    "sk",
    "skr",
    "sl",
    "sm",
    "smn",
    "sn",
    "so",
    "sq",
    "sr",
    "srn",
    "ss",
    "st",
    "stq",
    "su",
    "sv",
    "sw",
    "szl",
    "szy",
    "ta",
    "tay",
    "tcy",
    "te",
    "tet",
    "tg",
    "th",
    "ti",
    "tk",
    "tl",
    "tn",
    "to",
    "tpi",
    "tr",
    "trv",
    "ts",
    "tt",
    "tum",
    "tw",
    "ty",
    "tyv",
    "udm",
    "ug",
    "uk",
    "ur",
    "uz",
    "ve",
    "vec",
    "vep",
    "vi",
    "vls",
    "vo",
    "wa",
    "war",
    "wo",
    "wuu",
    "xal",
    "xh",
    "xmf",
    "yi",
    "yo",
    "yue",
    "za",
    "zea",
    "zh",
    "zh-classical",
    "zh-min-nan",
    "zh-yue",
    "zu",
    "zh-cn",
    "zh-tw",
    "egl",
    "gsw",
    "lzh",
    "nan",
    "nb",
    "rup",
    "sgs",
    "vro"
]

const defaultLangArray = [
    "Qaf√°r af",
    "–ê‘•—Å—à”ô–∞",
    "Ac√®h",
    "–ê–¥—ã–≥–∞–±–∑—ç",
    "Afrikaans",
    "Akan",
    "Alemannisch",
    "–ê–ª—Ç–∞–π —Ç–∏–ª",
    "·ä†·àõ·à≠·äõ",
    "Pangcah",
    "Aragon√©s",
    "√Ünglisc",
    "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",
    "‹ê‹™‹°‹ù‹ê",
    "ÿßŸÑÿØÿßÿ±ÿ¨ÿ©",
    "ŸÖÿµÿ±Ÿâ",
    "‡¶Ö‡¶∏‡¶Æ‡ßÄ‡¶Ø‡¶º‡¶æ",
    "Asturianu",
    "Atikamekw",
    "–ê–≤–∞—Ä",
    "Kotava",
    "‡§Ö‡§µ‡§ß‡•Ä",
    "Aymar aru",
    "Az…ôrbaycanca",
    "ÿ™€Üÿ±⁄©ÿ¨Ÿá",
    "–ë–∞—à“°–æ—Ä—Ç—Å–∞",
    "Basa Bali",
    "Boarisch",
    "≈Ωemaitƒó≈°ka",
    "Bikol Central",
    "–ë–µ–ª–∞—Ä—É—Å–∫–∞—è",
    "–ë–µ–ª–∞—Ä—É—Å–∫–∞—è (—Ç–∞—Ä–∞—à–∫–µ–≤—ñ—Ü–∞)",
    "–ë–µ–ª–∞—Ä—É—Å–∫–∞—è (—Ç–∞—Ä–∞—à–∫–µ–≤—ñ—Ü–∞)",
    "–ë—ä–ª–≥–∞—Ä—Å–∫–∏",
    "‡§≠‡•ã‡§ú‡§™‡•Å‡§∞‡•Ä",
    "Bislama",
    "Banjar",
    "·Äï·Ä°·Ä≠·ÄØ·Äù·Ä∫·Çè·Äò·Ä¨·Çè·Äû·Ä¨·Çè",
    "Bamanankan",
    "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ",
    "‡Ωñ‡Ωº‡Ωë‡ºã‡Ω°‡Ω≤‡ΩÇ",
    "‡¶¨‡¶ø‡¶∑‡ßç‡¶£‡ßÅ‡¶™‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶Æ‡¶£‡¶ø‡¶™‡ßÅ‡¶∞‡ßÄ",
    "Brezhoneg",
    "Bosanski",
    "·®Ö·®î ·®ï·®ò·®Å·®ó",
    "–ë—É—Ä—è–∞–¥",
    "Catal√†",
    "Chavacano de Zamboanga",
    "Èñ©Êù±Ë™û / M√¨ng-dƒïÃ§ng-ng·π≥ÃÑ",
    "–ù–æ—Ö—á–∏–π–Ω",
    "Cebuano",
    "Chamoru",
    "Chahta Anumpa",
    "·è£·é≥·é©",
    "Tsets√™hest√¢hese",
    "⁄©Ÿàÿ±ÿØ€å",
    "Corsu",
    "Nƒìhiyawƒìwin / ·ìÄ·ê¶·êÉ·î≠·êç·êè·ê£",
    "Qƒ±rƒ±mtatarca",
    "ƒåe≈°tina",
    "Kasz√´bsczi",
    "–°–ª–æ–≤—£–Ω—å—Å–∫—ä / ‚∞î‚∞é‚∞ë‚∞Ç‚∞°‚∞ê‚∞†‚∞î‚∞ç‚∞ü",
    "–ß”ë–≤–∞—à–ª–∞",
    "Cymraeg",
    "Dansk",
    "Dagbanli",
    "Deutsch",
    "Thu…î≈ãj√§≈ã",
    "Zazaki",
    "Dolnoserbski",
    "‡§°‡•ã‡§ü‡•á‡§≤‡•Ä",
    "ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®ﬁÑﬁ¶ﬁêﬁ∞",
    "‡Ωá‡Ωº‡ΩÑ‡ºã‡ΩÅ",
    "E ãegbe",
    "ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨",
    "Emili√†n e rumagn√≤l",
    "English",
    "Esperanto",
    "Espa√±ol",
    "Eesti",
    "Euskara",
    "Estreme√±u",
    "ŸÅÿßÿ±ÿ≥€å",
    "Fulfulde",
    "Suomi",
    "V√µro",
    "Na Vosa Vakaviti",
    "F√∏royskt",
    "Fran√ßais",
    "Arpetan",
    "Nordfriisk",
    "Furlan",
    "Frysk",
    "Gaeilge",
    "Gagauz",
    "Ë¥õË™û",
    "Kriy√≤l gwiyannen",
    "G√†idhlig",
    "Galego",
    "⁄Ø€åŸÑ⁄©€å",
    "Ava√±e'·∫Ω",
    "‡§ó‡•ã‡§Ç‡§Ø‡§ö‡•Ä ‡§ï‡•ã‡§Ç‡§ï‡§£‡•Ä / G√µychi Konknni",
    "Bahasa Hulontalo",
    "êå≤êåøêçÑêåπêçÉêå∫",
    "‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä",
    "Gungbe",
    "Gaelg",
    "Hausa",
    "ÂÆ¢ÂÆ∂Ë™û/Hak-k√¢-ng√Æ",
    "Hawai ªi",
    "◊¢◊ë◊®◊ô◊™",
    "‡§π‡§ø‡§®‡•ç‡§¶‡•Ä",
    "Fiji Hindi",
    "Hiri Motu",
    "Hrvatski",
    "Hornjoserbsce",
    "Krey√≤l ayisyen",
    "Magyar",
    "’Ä’°’µ’•÷Ä’•’∂",
    "‘±÷Ä’•÷Ç’¥’ø’°’∞’°’µ’•÷Ä’ß’∂",
    "Otsiherero",
    "Interlingua",
    "Bahasa Indonesia",
    "Interlingue",
    "Igbo",
    "ÍÜáÍâô",
    "I√±upiatun",
    "Ilokano",
    "–ì”Ä–∞–ª–≥”Ä–∞–π",
    "Ido",
    "√çslenska",
    "Italiano",
    "·êÉ·ìÑ·íÉ·ëé·ëê·ë¶/inuktitut",
    "Êó•Êú¨Ë™û",
    "Patois",
    "La .lojban.",
    "Jawa",
    "·≤•·Éê·É†·Éó·É£·Éö·Éò",
    "Qaraqalpaqsha",
    "Taqbaylit",
    "–ê–¥—ã–≥—ç–±–∑—ç",
    "Kab…©y…õ",
    "Tyap",
    "Kongo",
    "Gƒ©k≈©y≈©",
    "Kwanyama",
    "“ö–∞–∑–∞“õ—à–∞",
    "Kalaallisut",
    "·ûó·û∂·ûü·û∂·ûÅ·üí·ûò·üÇ·ûö",
    "‡≤ï‡≤®‡≥ç‡≤®‡≤°",
    "ÌïúÍµ≠Ïñ¥",
    "–ü–µ—Ä–µ–º –∫–æ–º–∏",
    "Kanuri",
    "–ö—ä–∞—Ä–∞—á–∞–π-–º–∞–ª–∫—ä–∞—Ä",
    "‡§ï‡•â‡§∂‡•Å‡§∞ / ⁄©Ÿ≤ÿ¥Ÿèÿ±",
    "Ripoarisch",
    "Kurd√Æ",
    "–ö–æ–º–∏",
    "Kernowek",
    "–ö—ã—Ä–≥—ã–∑—á–∞",
    "Latina",
    "Ladino",
    "L√´tzebuergesch",
    "–õ–∞–∫–∫—É",
    "–õ–µ–∑–≥–∏",
    "Lingua Franca Nova",
    "Luganda",
    "Limburgs",
    "Ligure",
    "Ladin",
    "Lombard",
    "Ling√°la",
    "‡∫•‡∫≤‡∫ß",
    "ŸÑ€äÿ±€å ÿ¥ŸàŸÖÿßŸÑ€å",
    "Lietuvi≈≥",
    "Latgaƒºu",
    "Latvie≈°u",
    "Madhur√¢",
    "‡§Æ‡•à‡§•‡§ø‡§≤‡•Ä",
    "Basa Banyumasan",
    "–ú–æ–∫—à–µ–Ω—å",
    "Malagasy",
    "Ebon",
    "–û–ª—ã–∫ –º–∞—Ä–∏–π",
    "MƒÅori",
    "Minangkabau",
    "–ú–∞–∫–µ–¥–æ–Ω—Å–∫–∏",
    "‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç",
    "–ú–æ–Ω–≥–æ–ª",
    "ÍØÉÍØ§ÍØáÍØ© ÍØÇÍØ£ÍØü",
    "·Äò·Ä¨·Äû·Ä¨ ·Äô·Äî·Ä∫",
    "–ú–æ–ª–¥–æ–≤–µ–Ω—è—Å–∫—ç",
    "‡§Æ‡§∞‡§æ‡§†‡•Ä",
    "–ö—ã—Ä—ã–∫ –º–∞—Ä—ã",
    "Bahasa Melayu",
    "Malti",
    "Mvskoke",
    "Mirand√©s",
    "·Äô·Äº·Äî·Ä∫·Äô·Ä¨·Äò·Ä¨·Äû·Ä¨",
    "–≠—Ä–∑—è–Ω—å",
    "ŸÖÿßÿ≤Ÿêÿ±ŸàŸÜ€å",
    "Dorerin Naoero",
    "NƒÅhuatl",
    "Napulitano",
    "Plattd√º√ºtsch",
    "Nedersaksies",
    "‡§®‡•á‡§™‡§æ‡§≤‡•Ä",
    "‡§®‡•á‡§™‡§æ‡§≤ ‡§≠‡§æ‡§∑‡§æ",
    "Oshiwambo",
    "Li Niha",
    "Nederlands",
    "Norsk nynorsk",
    "Norsk",
    "Novial",
    "ﬂíﬂûﬂè",
    "Nouormand",
    "Sesotho sa Leboa",
    "Din√© bizaad",
    "Chi-Chewa",
    "Occitan",
    "Livvinkarjala",
    "Oromoo",
    "‡¨ì‡¨°‡¨º‡¨ø‡¨Ü",
    "–ò—Ä–æ–Ω",
    "‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä",
    "Pangasinan",
    "Kapampangan",
    "Papiamentu",
    "Picard",
    "Naij√°",
    "Deitsch",
    "P√§lzisch",
    "‡§™‡§æ‡§≤‡§ø",
    "Norfuk / Pitkern",
    "Polski",
    "Piemont√®is",
    "ŸæŸÜÿ¨ÿßÿ®€å",
    "Œ†ŒøŒΩœÑŒπŒ±Œ∫Œ¨",
    "Ÿæ⁄öÿ™Ÿà",
    "Portugu√™s",
    "Pinayuanan",
    "Runa Simi",
    "Rumantsch",
    "Romani ƒçhib",
    "Ikirundi",
    "Rom√¢nƒÉ",
    "Arm√£neashti",
    "Tarand√≠ne",
    "–†—É—Å—Å–∫–∏–π",
    "–†—É—Å–∏–Ω—å—Å–∫—ã–π",
    "Ikinyarwanda",
    "‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§Æ‡•ç",
    "–°–∞—Ö–∞ —Ç—ã–ª–∞",
    "·±•·±ü·±±·±õ·±ü·±≤·±§",
    "Sardu",
    "Sicilianu",
    "Scots",
    "ÿ≥ŸÜ⁄åŸä",
    "Davvis√°megiella",
    "S√§ng√∂",
    "Srpskohrvatski / —Å—Ä–ø—Å–∫–æ—Ö—Ä–≤–∞—Ç—Å–∫–∏",
    "Tacl·∏•it",
    "·ÅΩ·ÇÉ·Çá·Äû·ÇÉ·Çá·Äê·ÇÜ·Ä∏ ",
    "Tacawit",
    "‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω",
    "Simple English",
    "Slovenƒçina",
    "ÿ≥ÿ±ÿßÿ¶€å⁄©€å",
    "Sloven≈°ƒçina",
    "Gagana Samoa",
    "Anar√¢≈°kiel√¢",
    "ChiShona",
    "Soomaaliga",
    "Shqip",
    "–°—Ä–ø—Å–∫–∏ / srpski",
    "Sranantongo",
    "SiSwati",
    "Sesotho",
    "Seeltersk",
    "Sunda",
    "Svenska",
    "Kiswahili",
    "≈öl≈Ønski",
    "Sakizaya",
    "‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç",
    "Tayal",
    "‡≤§‡≥Å‡≤≥‡≥Å",
    "‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å",
    "Tetun",
    "–¢–æ“∑–∏–∫”£",
    "‡πÑ‡∏ó‡∏¢",
    "·âµ·åç·à≠·äõ",
    "T√ºrkmen√ße",
    "Tagalog",
    "Setswana",
    "Lea faka-Tonga",
    "Tok Pisin",
    "T√ºrk√ße",
    "Seediq",
    "Xitsonga",
    "–¢–∞—Ç–∞—Ä—á–∞/tatar√ßa",
    "ChiTumbuka",
    "Twi",
    "Reo tahiti",
    "–¢—ã–≤–∞ –¥—ã–ª",
    "–£–¥–º—É—Ä—Ç",
    "ÿ¶€áŸäÿ∫€áÿ±⁄Ü€ï / Uyghurche",
    "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞",
    "ÿßÿ±ÿØŸà",
    "O ªzbekcha/—û–∑–±–µ–∫—á–∞",
    "Tshivenda",
    "V√®neto",
    "Veps√§n kel‚Äô",
    "Ti·∫øng Vi·ªát",
    "West-Vlams",
    "Volap√ºk",
    "Walon",
    "Winaray",
    "Wolof",
    "Âê¥ËØ≠",
    "–•–∞–ª—å–º–≥",
    "IsiXhosa",
    "·≤õ·Éê·É†·Éí·Éê·Éö·É£·É†·Éò",
    "◊ô◊ô÷¥◊ì◊ô◊©",
    "Yor√πb√°",
    "Á≤µË™û",
    "Vahcuengh",
    "Ze√™uws",
    "‰∏≠Êñá",
    "ÊñáË®Ä",
    "B√¢n-l√¢m-g√∫",
    "Á≤µË™û",
    "IsiZulu",
    "‰∏≠ÊñáÔºà‰∏≠ÂõΩÂ§ßÈôÜÔºâ",
    "‰∏≠ÊñáÔºàËá∫ÁÅ£Ôºâ",
    "Emili√†n",
    "Alemannisch",
    "ÊñáË®Ä",
    "B√¢n-l√¢m-g√∫",
    "Norsk bokm√•l",
    "Arm√£neashti",
    "≈Ωemaitƒó≈°ka",
    "V√µro"
]

// Function for obtaining updated list of Wikipedias
function getWikis() {
    return new Promise(async function (resolve, reject) {
        // Download list of Wikis
        try {
            const response = await fetch('https://sv.wikipedia.org/w/api.php?action=query&meta=siteinfo&siprop=interwikimap&sifilteriw=local&format=json', {
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            if (!response.ok) {
                console.log('Could not obtain data from Wikipedia API.')
                resolve(defaultWikiArray, defaultLangArray)
            }
            const json = await response.json()
            // Parse list
            const wikiList = json.query.interwikimap
            console.log('Wiki list downloaded, contains ' + wikiList.length + ' items.')
            // Create new arrays with only the active language wikis
            var wikiPrefixArray = []
            var wikiLangArray = []
            for (i in wikiList) {
                if (wikiList[i].language) {
                    wikiPrefixArray.push(wikiList[i].prefix)
                    var langCapitalized = wikiList[i].language.charAt(0).toUpperCase() + wikiList[i].language.slice(1)
                    wikiLangArray.push(langCapitalized)
                }
            }
            // Save to chrome.storage for Omnibox use
            chrome.storage.local.set({
                wikiPrefixArray: wikiPrefixArray,
                wikiLangArray: wikiLangArray
            }, function () {
                resolve([wikiPrefixArray, wikiLangArray])
            })
        } catch (error) {
            console.log('Could not obtain data from Wikipedia API: ' + error)
            chrome.storage.local.set({
                wikiPrefixArray: defaultPrefixArray,
                wikiLangArray: defaultLangArray
            }, function () {
                resolve([defaultPrefixArray, defaultLangArray])
            })
        }
    })
}

// Function for detecting system language and setting it to the default search language
function resetToSystemLanguage() {
    var lang = navigator.languages[0]
    var newLang = ''
    // Cut off the localization part if it exists (e.g. en-US becomes en), to match with Wikipedia's format
    var n = lang.indexOf('-')
    lang = lang.substring(0, n != -1 ? n : lang.length)
    // Check if the language has a Wikipedia
    if (defaultPrefixArray.includes(lang)) {
        console.log("Language auto-detected as '" + lang + "' (" + defaultLangArray[defaultPrefixArray.indexOf(lang)] + ")")
        newLang = lang
    } else {
        // Set it to English as default
        console.log("Could not auto-detect language, defaulting to 'en' (English)")
        newLang = 'en'
    }
    // Update language setting
    chrome.storage.local.set({
        userLanguage: newLang
    })
    // Return new language
    return newLang
}